"use strict";(self.webpackChunkaml_website=self.webpackChunkaml_website||[]).push([[457],{3416:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(7294),i=a(1736);const r={testsUrl:"https://raw.githubusercontent.com/aml-org/examples/master/AMF4/src/test/",mainUrl:"https://raw.githubusercontent.com/aml-org/examples/master/AMF4/src/main/"},l={testsUrl:"https://raw.githubusercontent.com/aml-org/examples/master/AMF5/src/test/",mainUrl:"https://raw.githubusercontent.com/aml-org/examples/master/AMF5/src/main/",scala:"scala/scalaPlatform/",java:"java/javaPlatform/",ts:"ts/"};const o=e=>{let{AMFVersion:t,language:a,example:o,lineStart:s,lineEnd:d,hideLink:c,fromMain:u}=e;const m=(0,n.useRef)(!0),[h,p]=(0,n.useState)(""),[v,k]=(0,n.useState)(""),f=(0,n.useCallback)((async()=>{const e=function(e){return"v4"===e?r:l}(t),n=function(e,t){if(t===r)return"";switch(e){case"scala":default:return t.scala;case"java":return t.java;case"ts":return t.ts;case"js":return t.js}}(a,e),i=(u?e.mainUrl:e.testsUrl)+n+o,c=i.replace("raw.githubusercontent.com/aml-org/examples","github.com/aml-org/examples/tree"),h=await fetch(i),v=await h.text();if(!m.current)return null;if(k(c),p(v),d-s>0){let e=v.split("\n").slice(s,d).join("\n");p(e)}}),[]);return(0,n.useEffect)((()=>(f(),()=>{m.current=!1})),[]),n.createElement("div",null,n.createElement(i.Z,{className:a},h),!c&&n.createElement("p",null,"Code extracted from the examples ",n.createElement("strong",null,n.createElement("a",{href:v},"GitHub repository")),"."))}},630:(e,t,a)=>{a.r(t),a.d(t,{frontMatter:()=>l,contentTitle:()=>o,metadata:()=>s,toc:()=>d,default:()=>u});var n=a(7462),i=(a(7294),a(3905)),r=a(3416);const l={id:"scheduler",title:"Control threads in AMF"},o=void 0,s={unversionedId:"Customizable Configurations/scheduler",id:"version-4.x.x/Customizable Configurations/scheduler",title:"Control threads in AMF",description:"AMF allows you to schedule and manage the lifespan of threads.",source:"@site/versioned_docs/version-4.x.x/Customizable Configurations/scheduler.mdx",sourceDirName:"Customizable Configurations",slug:"/Customizable Configurations/scheduler",permalink:"/docs/v4/Customizable Configurations/scheduler",editUrl:"https://github.com/aml-org/a-ml/edit/develop/versioned_docs/version-4.x.x/Customizable Configurations/scheduler.mdx",tags:[],version:"4.x.x",lastUpdatedBy:"arielmirra",lastUpdatedAt:1631204521,formattedLastUpdatedAt:"9/9/2021",frontMatter:{id:"scheduler",title:"Control threads in AMF"},sidebar:"version-4.x.x/myAutogeneratedSidebar",previous:{title:"Custom resource loaders",permalink:"/docs/v4/Customizable Configurations/resource_loaders"},next:{title:"AMF Conversion",permalink:"/docs/v4/Related Docs/amf_conversion"}},d=[{value:"Controlling thread generation and lifespan",id:"controlling-thread-generation-and-lifespan",children:[],level:2},{value:"Create a <code>ScheduledExecutorService</code>",id:"create-a-scheduledexecutorservice",children:[{value:"Scheduler API methods",id:"scheduler-api-methods",children:[],level:3}],level:2},{value:"Create and add the <code>ExecutionEnvironment</code> in AMF",id:"create-and-add-the-executionenvironment-in-amf",children:[],level:2},{value:"Example code for creating a scheduler",id:"example-code-for-creating-a-scheduler",children:[],level:2}],c={toc:d};function u(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"AMF allows you to schedule and manage the lifespan of threads.\nThe following explains how to create and use a scheduler in AMF."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Use of control threads in AMF is specific to Java or Scala applications."))),(0,i.kt)("p",null,"In AMF, common uses of thread control include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Addressing memory constraints"),(0,i.kt)("li",{parentName:"ul"},"Controlling thread creation"),(0,i.kt)("li",{parentName:"ul"},"Inserting time intervals between AMF executions")),(0,i.kt)("h2",{id:"controlling-thread-generation-and-lifespan"},"Controlling thread generation and lifespan"),(0,i.kt)("p",null,"AMF allows you to control thread generation and lifespan by customizing the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"ExecutionEnvironment"))," object.\nTo customize the ExecutionEnvironment object you need to:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create a ",(0,i.kt)("inlineCode",{parentName:"li"},"java.util.concurrent.ScheduledExecutorService")),(0,i.kt)("li",{parentName:"ol"},"Create an ",(0,i.kt)("inlineCode",{parentName:"li"},"amf.client.execution.ExecutionEnvironment")," with the new scheduler"),(0,i.kt)("li",{parentName:"ol"},"Plug the ",(0,i.kt)("inlineCode",{parentName:"li"},"ExecutionEnvironment")," into AMF initialization or in resolution stage")),(0,i.kt)("h2",{id:"create-a-scheduledexecutorservice"},"Create a ",(0,i.kt)("inlineCode",{parentName:"h2"},"ScheduledExecutorService")),(0,i.kt)("p",null,"To create a thread pool that can schedule commands to run after a given delay, or to execute them periodically, create a ",(0,i.kt)("inlineCode",{parentName:"p"},"ScheduledExecutorService"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(30, new ThreadFactory() {\n            int i = 0;\n\n            @Override\n            public Thread newThread(Runnable r) {\n                i = i + 1;\n                final Thread thread = new Thread(r);\n                thread.setName("AMF-" + i);\n                return thread;\n            }\n        });\n')),(0,i.kt)("p",null,"This example scheduler keeps 30 threads in the pool (even if they are idle), and creates a specific ",(0,i.kt)("inlineCode",{parentName:"p"},"ThreadFactory")," that sets the thread name when creating a new thread."),(0,i.kt)("h3",{id:"scheduler-api-methods"},"Scheduler API methods"),(0,i.kt)("p",null,"The scheduler exposes the following methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"scheduled()"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Schedule a single task execution after a fixed delay"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"scheduleAtFixedRate()"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Run a task periodically after a fixed delay"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"shutdown()"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Stop the ",(0,i.kt)("inlineCode",{parentName:"li"},"ExecutorService")," from accepting new tasks and shut down after all running threads finish their current work"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"shutdownNow()"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Return a list of tasks that are waiting to be processed, and destroy the ",(0,i.kt)("inlineCode",{parentName:"li"},"ExecutorService")," immediately"),(0,i.kt)("li",{parentName:"ul"},"All running threads may not be stopped at the same time")))),(0,i.kt)("p",null,"Refer to the Java documentation for more information about the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ScheduledExecutorService.html"},(0,i.kt)("inlineCode",{parentName:"a"},"ScheduledExecutorService"))),(0,i.kt)("h2",{id:"create-and-add-the-executionenvironment-in-amf"},"Create and add the ",(0,i.kt)("inlineCode",{parentName:"h2"},"ExecutionEnvironment")," in AMF"),(0,i.kt)("p",null,"When initialized, AMF creates a default ",(0,i.kt)("inlineCode",{parentName:"p"},"amf.client.environment.Environment"),". You can customize this environment by passing an ",(0,i.kt)("inlineCode",{parentName:"p"},"amf.client.execution.ExecutionEnvironment")," object."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"ExecutionEnvironment")," is responsible for thread creation, and it can receive a ",(0,i.kt)("inlineCode",{parentName:"p"},"ScheduledExecutorService")," to use when creating threads."),(0,i.kt)("p",null,"You can plug your customized ",(0,i.kt)("inlineCode",{parentName:"p"},"ExecutionEnvironment")," into AMF's initialization, or add it when creating a specific parser."),(0,i.kt)("p",null,"This customized environment can be plugged into AMF's initialization or when creating a specific parser."),(0,i.kt)("h2",{id:"example-code-for-creating-a-scheduler"},"Example code for creating a scheduler"),(0,i.kt)("p",null,"The following example code shows the creation of a scheduler, and its usage throughout AMF:"),(0,i.kt)(r.Z,{AMFVersion:"v4",language:"java",example:"java/SchedulerTest.java",mdxType:"CodeGetter"}))}u.isMDXComponent=!0}}]);